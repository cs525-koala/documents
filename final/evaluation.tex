\section{Evaluation}
\label{sec:eval}

\fig{koala_average_task_times}{1.5}{Average task durations for Eucalyptus and Koala}
\fig{koala_average_task_ratio}{1.5}{Improvement of Koala over Eucalytpus}

Our current setup for Koala uses six computers.  The Eucalyptus Cloud Level Controller, Cluster Controller, and Storage Controller all are running on a Debian Squeeze machine, with dual 2.33GHz quad core processors and 4GB of ram.  The Walrus Controller is running on a CentOS 5 machine, with a 3GHz dual core processor and 4GB of ram.  We also have four CCT machines, which are running CentOS 5, each with dual 2.67GHz quad core processors and 16GB of ram.  Three of the CCT machines are running the Node Controllers (and VMs), all of which use QEMU with KVM support to run the VMs.  The other CCT machine is used to run an NFS server, in order to provide shared storage for the other machines.

We designed our dynamic scheduler to be able to be enabled and disabled without restarting the Cluster Controller.  We model a traditional Eucalyptus installation by disabling the dynamic scheduler.  Although parts of our implementation, such as the storage of VMs on NFS, are not commonly used in Eucalyptus implementations, other than for the dynamic monitoring information and Eucalyptus liveness management, the network is mostly unused.  As a result, our evaluation is not limited by the network ``disk'' speeds, and should be negligibly different from a standard Eucalyptus install.  We enable the dynamic scheduler for the Koala versions of our evaluation.

Our experiment uses 15 single core VMs, each with 1.5GB of memory.  At the beginning of every pass of our experiment, every Node Controller starts with the same 5 VMs.  We run a single CPU intensive \emph{task} (described below) on each of the VMs.  On each pass, these tasks are spawned at consistent times on each of the VMs.  These tasks consist of simple mathematical calculations run in bc (a basic command line calculator).  On an uncontested (other than Node Controller and the VM operating systems) CPU, a task finishes in approximately 354 seconds.  In the traditional Eucalyptus setup, these VMs remain in place on the same Node Controller for the duration of these tasks.  In the Koala setup, the dynamic scheduler moves the VMs around, based on scores calculated from dynamically observed CPU utilization.  We run every path on both versions of the system and compare the results below.

On the first pass, we run one task inside each VMs.  On the second pass, we run the same tasks at the same times for each of the VMs.  In addition to this, we also run CPU intensive \emph{loads} (note the difference from tasks) on two of the Node Controllers (outside the VMs).  These loads consist of a looped process alternating between bc calculations and nothing (a call to sleep), and use varying sleep durations, in order to load one Node Controller 30\% more than the other.  On additional passes, we continue to add more loads to the two node controllers.

Figure \ref{fig:koala_average_task_times} shows the average run times of the bc tasks on each of the 15 instances.  At around 5 load tasks, Eucalyptus begins to exhibit significant slowdowns, where Koala is mostly unaffected.  Figure \ref{fig:koala_average_task_ratio} shows the ratio between these times for Koala and the Eucalyptus baseline system.

As shown in Figures \ref{fig:koala_average_task_times},\ref{fig:koala_average_task_ratio}, as the load on the system increases, Koala's performance degrades much less than a standard Eucalyptus system.  When there are no or few load processes on the nodes, Koala performs almost identically to Eucalyptus, as the system isn't fully utilized to begin with.  As the number of load processes increase, the points at which machines are overloaded are more frequent, and Koala's scheduler has more opportunity to improve the configuration of the VMs.

As seen above, up to approximately 5 load processes, Koala behaves on par with the base Eucalyptus setup.  By the time there are 9 load processes, Koala performs over 50\% better than the base installation of eucalyptus.  This is the point where the loads are significant enough for Koala to significantly leverage the unused resources.  Without sufficient load, the overhead of migration has a significant cost, and Koala can do little to improve the performance.  By the time there are 11 or 12 load processes, the cost of migration is insignificant in comparison to the unused resources.  This is where Koala really shines, and the result is over 100\% improvement in comparison with the base install.
\KComment{Murph: Actually interpret the results!}
